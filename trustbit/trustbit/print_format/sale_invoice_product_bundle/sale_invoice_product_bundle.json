{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2025-05-03 14:24:34.338480",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Sales Invoice",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "<style>\ntable { width: 100%; border-collapse: collapse; font-size: 12px; line-height: 2px; }\nth, td { border: 1px solid #000; padding: 4px; text-align: left; }\n.no-border { border: none !important; }\n.group-header { font-weight: bold; background-color: #f0f0f0; }\n.right-align { text-align: right; }\n.bold { font-weight: bold; }\n</style>\n\n{# === Letterhead Section === #}\n{% if letter_head %}\n<div class=\"letter-head\">\n    {{ letter_head }}\n</div>\n{% endif %}\n\n<div style=\"display: flex; justify-content: space-between;\">\n    <div>\n        <p>\n            <b>Party:</b> {{ doc.customer }}<br>\n            <b>Add:</b> <br>\n            <b>Mobile No.:</b> {{ frappe.db.get_value(\"Customer\", {\"name\": doc.customer}, \"mobile_no\") or \"\" }}\n        </p>\n    </div>\n    <div style=\"text-align: right;\">\n        <p>\n            <b>Bill No:</b> {{ doc.name }}<br>\n            <b>Date:</b> {{ frappe.utils.formatdate(doc.posting_date, \"dd/MM/yy\") }}\n        </p>\n    </div>\n</div>\n\n{% set currency_code = frappe.db.get_value(\"Company\", doc.company, \"default_currency\") %}\n{% set currency_symbols = {\n    \"INR\": \"\u20b9\",\n    \"USD\": \"$\",\n    \"EUR\": \"\u20ac\",\n    \"AED\": \"\u062f.\u0625\",\n    \"GBP\": \"\u00a3\",\n    \"JPY\": \"\u00a5\",\n    \"CNY\": \"\u00a5\",\n    \"SAR\": \"\ufdfc\",\n    \"CAD\": \"C$\",\n    \"AUD\": \"A$\"\n} %}\n{% set currency = currency_symbols.get(currency_code, currency_code) %}\n{% set ns = namespace(sn=1, grand_total=0.0) %}\n\n<table>\n    <thead>\n        <tr>\n            <th>SN.</th>\n            <th>Description</th>\n            <th>Company</th>\n            <th>Qty.</th>\n            <th>Unit</th>\n            <th>Price</th>\n            <th>Dis</th>\n            <th>Amount</th>\n        </tr>\n    </thead>\n    <tbody>\n\n        {# ======= Available Items by Bundle ======= #}\n        {% for bundle in doc.items | map(attribute='custom_bundle_id') | unique %}\n            {% if bundle %}\n                {% set bundle_doc = frappe.get_doc('Product Bundle', bundle) %}\n                {% set available_items = bundle_doc.items | selectattr('custom_product_bundle_stock', 'equalto', 'Available') | list %}\n                {% set available_codes = available_items | map(attribute='item_code') | list %}\n\n                {% if available_items %}\n                    <tr class=\"group-header\">\n                        <td colspan=\"8\">{{ bundle_doc.description }} ({{ available_items | length }} items - Available)</td>\n                    </tr>\n\n                    {% set gns = namespace(group_total=0.0) %}\n\n                    {% for item in doc.items %}\n                        {% if item.custom_bundle_id == bundle and item.item_code in available_codes %}\n                            <tr>\n                                <td>{{ ns.sn }}</td>\n                                <td>{{ item.item_name }}</td>\n                                <td>{{ item.brand or '' }}</td>\n                                <td>{{ item.qty }}</td>\n                                <td>{{ item.uom }}</td>\n                                <td>{{ currency }}{{ \"{:,.2f}\".format(item.rate) }}</td>\n                                <td>{{ item.discount_percentage or '0.0' }}%</td>\n                                <td>{{ currency }}{{ \"{:,.2f}\".format(item.amount) }}</td>\n                            </tr>\n                            {% set gns.group_total = gns.group_total + item.amount %}\n                            {% set ns.grand_total = ns.grand_total + item.amount %}\n                            {% set ns.sn = ns.sn + 1 %}\n                        {% endif %}\n                    {% endfor %}\n\n                    <tr class=\"bold\">\n                        <td colspan=\"7\" class=\"right-align\">Group Total</td>\n                        <td>{{ currency }}{{ \"{:,.2f}\".format(gns.group_total) }}</td>\n                    </tr>\n                {% endif %}\n            {% endif %}\n        {% endfor %}\n\n        {# ======= Not Available Items by Bundle ======= #}\n        {% for bundle in doc.items | map(attribute='custom_bundle_id') | unique %}\n            {% if bundle %}\n                {% set bundle_doc = frappe.get_doc('Product Bundle', bundle) %}\n                {% set not_available_items = bundle_doc.items | selectattr('custom_product_bundle_stock', 'equalto', 'Not Available') | list %}\n                {% set not_available_codes = not_available_items | map(attribute='item_code') | list %}\n\n                {% if not_available_items %}\n                    <tr class=\"group-header\">\n                        <td colspan=\"8\">{{ bundle_doc.description }} ({{ not_available_items | length }} items - Not Available)</td>\n                    </tr>\n\n                    {% set gns = namespace(group_total=0.0) %}\n\n                    {% for item in doc.items %}\n                        {% if item.custom_bundle_id == bundle and item.item_code in not_available_codes %}\n                            <tr>\n                                <td>{{ ns.sn }}</td>\n                                <td>{{ item.item_name }}</td>\n                                <td>{{ item.brand or '' }}</td>\n                                <td>{{ item.qty }}</td>\n                                <td>{{ item.uom }}</td>\n                                <td>{{ currency }}{{ \"{:,.2f}\".format(item.rate) }}</td>\n                                <td>{{ item.discount_percentage or '0.0' }}%</td>\n                                <td>{{ currency }}{{ \"{:,.2f}\".format(item.amount) }}</td>\n                            </tr>\n                            {% set gns.group_total = gns.group_total + item.amount %}\n                            {% set ns.grand_total = ns.grand_total + item.amount %}\n                            {% set ns.sn = ns.sn + 1 %}\n                        {% endif %}\n                    {% endfor %}\n\n                    <tr class=\"bold\">\n                        <td colspan=\"7\" class=\"right-align\">Group Total</td>\n                        <td>{{ currency }}{{ \"{:,.2f}\".format(gns.group_total) }}</td>\n                    </tr>\n                {% endif %}\n            {% endif %}\n        {% endfor %}\n\n        {# ======= Items Without Bundle ======= #}\n        {% set unbundled_items = doc.items | selectattr(\"custom_bundle_id\", \"equalto\", None) | list %}\n        {% if unbundled_items %}\n            <tr class=\"group-header\">\n                <td colspan=\"8\">Items Without Bundle ({{ unbundled_items | length }} items)</td>\n            </tr>\n            {% set gns = namespace(group_total=0.0) %}\n            {% for item in unbundled_items %}\n                <tr>\n                    <td>{{ ns.sn }}</td>\n                    <td>{{ item.item_name }}</td>\n                    <td>{{ item.brand or '' }}</td>\n                    <td>{{ item.qty }}</td>\n                    <td>{{ item.uom }}</td>\n                    <td>{{ currency }}{{ \"{:,.2f}\".format(item.rate) }}</td>\n                    <td>{{ item.discount_percentage or '0.0' }}%</td>\n                    <td>{{ currency }}{{ \"{:,.2f}\".format(item.amount) }}</td>\n                </tr>\n                {% set gns.group_total = gns.group_total + item.amount %}\n                {% set ns.grand_total = ns.grand_total + item.amount %}\n                {% set ns.sn = ns.sn + 1 %}\n            {% endfor %}\n            <tr class=\"bold\">\n                <td colspan=\"7\" class=\"right-align\">Group Total</td>\n                <td>{{ currency }}{{ \"{:,.2f}\".format(gns.group_total) }}</td>\n            </tr>\n        {% endif %}\n\n        {# ======= Missing Items from Bundles ======= #}\n        {% for bundle in doc.items | map(attribute='custom_bundle_id') | unique %}\n            {% if bundle %}\n                {% set bundle_doc = frappe.get_doc('Product Bundle', bundle) %}\n                {% set all_bundle_codes = bundle_doc.items | map(attribute='item_code') | list %}\n                {% set billed_codes = doc.items | selectattr('custom_bundle_id', 'equalto', bundle) | map(attribute='item_code') | list %}\n                {% set missing_codes = all_bundle_codes | reject('in', billed_codes) | list %}\n\n                {% if missing_codes %}\n                    <tr class=\"group-header\">\n                        <td colspan=\"8\">Missing Items in Bundle: {{ bundle_doc.description }}</td>\n                    </tr>\n\n                    {% set gns = namespace(group_total=0.0) %}\n\n                    {% for b_item in bundle_doc.items %}\n                        {% if b_item.item_code in missing_codes %}\n                            {% set missing_item = frappe.get_doc(\"Item\", b_item.item_code) %}\n                            {% set item_name = missing_item.item_name or '' %}\n                            {% set brand = missing_item.brand or '' %}\n                            {% set uom = missing_item.stock_uom or 'Nos' %}\n                            {% set qty = b_item.qty or 1 %}\n                            {% set item_price = frappe.db.get_value(\"Item Price\", {\"item_code\": b_item.item_code, \"selling\": 1}, \"price_list_rate\") or 0.0 %}\n                            {% set rate = item_price %}\n                            {% set discount = 0.0 %}\n                            {% set calc_amount = rate * qty %}\n\n                            <tr>\n                                <td>{{ ns.sn }}</td>\n                                <td>{{ item_name }}</td>\n                                <td>{{ brand }}</td>\n                                <td>{{ qty }}</td>\n                                <td>{{ uom }}</td>\n                                <td>{{ currency }}{{ \"{:,.2f}\".format(rate) }}</td>\n                                <td>{{ discount }}%</td>\n                                <td class=\"right-align\">{{ currency }}{{ \"{:,.2f}\".format(calc_amount) }}</td>\n                            </tr>\n                            {% set gns.group_total = gns.group_total + calc_amount %}\n                            {% set ns.sn = ns.sn + 1 %}\n                        {% endif %}\n                    {% endfor %}\n\n                    {% set ns.grand_total = ns.grand_total + gns.group_total %}\n\n                    <tr class=\"bold\">\n                        <td colspan=\"7\" class=\"right-align\">Group Total</td>\n                        <td class=\"right-align\">{{ currency }}{{ \"{:,.2f}\".format(gns.group_total) }}</td>\n                    </tr>\n                {% endif %}\n            {% endif %}\n        {% endfor %}\n\n    </tbody>\n</table>\n\n<p class=\"bold right-align\" style=\"margin-top:10px;\"><b>Grand Total:</b> {{ currency }}{{ \"{:.2f}\".format(ns.grand_total) }}</p>\n\n<hr>\n\n<p class=\"bold\"><b>Terms & Conditions:</b></p>\n<ol>\n    <li>{{ doc.terms }}</li>\n</ol>\n\n<p class=\"bold right-align\"><b>Amount in Words:</b> {{ doc.in_words }}</p>\n\n<p class=\"right-align\">For Splashbox<br><br><br>\nAuthorized Signatory</p>\n\n{# === Footer Section === #}\n{% if footer %}\n<div class=\"letter-footer\" style=\"margin-top: 30px; border-top: 1px solid #000; padding-top: 10px;\">\n    {{ footer }}\n</div>\n{% endif %}\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2025-05-09 10:43:07.427544",
 "modified_by": "Administrator",
 "module": "Trustbit",
 "name": "Sale Invoice Product Bundle",
 "owner": "Administrator",
 "page_number": "Hide",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}